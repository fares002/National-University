# CI/CD Pipeline for National University System
# This workflow automatically deploys the application when code is pushed to main branch

name: Deploy to Client Laptop

# Trigger: Run this workflow when code is pushed to the main branch
on:
  push:
    branches:
      - main

# Jobs: The steps that will run
jobs:
  deploy:
    # Run on the self-hosted runner we just installed (NU_RUNNER)
    runs-on: self-hosted

    # Set default shell with bypass execution policy
    defaults:
      run:
        shell: pwsh -ExecutionPolicy Bypass -Command "& '{0}'"

    steps:
      # Step 1: Display deployment start message
      - name: üì¢ Deployment Started
        run: |
          Write-Host "========================================" -ForegroundColor Cyan
          Write-Host "Deployment triggered by: ${{ github.actor }}" -ForegroundColor Yellow
          Write-Host "Commit: ${{ github.event.head_commit.message }}" -ForegroundColor Yellow
          Write-Host "========================================" -ForegroundColor Cyan

      # Step 2: Navigate to the project directory
      - name: üìÅ Navigate to Project Directory
        run: cd C:\Users\freem\National-University

      # Step 3: Run the deployment script
      - name: üöÄ Execute Deployment Script
        run: |
          cd C:\Users\freem\National-University
          & .\deploy.ps1

      # Step 4: Display deployment completion
      - name: ‚úÖ Deployment Complete
        run: |
          Write-Host "========================================" -ForegroundColor Green
          Write-Host "Deployment completed successfully!" -ForegroundColor Green
          Write-Host "Application is now running at:" -ForegroundColor Cyan
          Write-Host "  Frontend: http://localhost" -ForegroundColor White
          Write-Host "  Backend:  http://localhost:3000" -ForegroundColor White
          Write-Host "========================================" -ForegroundColor Green

      # Step 5: Send notification on failure
      - name: ‚ùå Deployment Failed
        if: failure()
        run: |
          Write-Host "========================================" -ForegroundColor Red
          Write-Host "Deployment FAILED!" -ForegroundColor Red
          Write-Host "Check the logs above for details" -ForegroundColor Red
          Write-Host "========================================" -ForegroundColor Red
